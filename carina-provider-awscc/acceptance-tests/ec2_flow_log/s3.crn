# EC2 Flow Log - S3 destination test
#
# Tests: log_destination_type=s3, traffic_type, resource_type, resource_id,
#        log_destination, destination_options (Struct)

provider awscc {
  region = awscc.Region.ap_northeast_1
}

let vpc = awscc.ec2.vpc {
  cidr_block = "10.0.0.0/16"
}

let bucket = awscc.s3.bucket {
  lifecycle {
    force_delete = true
  }
}

let flow_log = awscc.ec2.flow_log {
  resource_id          = vpc.vpc_id
  resource_type        = VPC
  traffic_type         = ALL
  log_destination_type = s3
  log_destination      = bucket.arn

  destination_options = {
    file_format                = "plain-text"
    hive_compatible_partitions = false
    per_hour_partition         = false
  }

  tags = {
    Environment = "acceptance-test"
  }
}
